name: Generate lighthouse test report on PR
on:
    workflow_dispatch:
    push:
        branches: [ lighthouse_testing_pipeline ]
    pull_request:
        branches: [ main, lighthouse_testing_pipeline ]
    # paths:
    #     - "estate_dao_nft/**"

jobs:
    build-check:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repo
            uses: actions/checkout@v3
                  actions/setup-node@v3


          - name: Rust Setup
            uses: dtolnay/rust-toolchain@master
            with:
                toolchain: "nightly"
                targets: "x86_64-unknown-linux-musl,wasm32-unknown-unknown"
                components: "clippy,rustfmt"

          - uses: cargo-bins/cargo-binstall@main
          - name: cargo-leptos setup
            run: cargo binstall --no-confirm cargo-leptos --version 0.2.16

          - name: Cache rust dependencies and build output
            uses: Swatinem/rust-cache@v2

          - name: Install Node.js
            uses: actions/setup-node@v4
            with:
                node-version: 20

          - name: Build and run Locally
            run: cargo leptose build --release
                  cargo watch

          - name: Install Lighthouse
            run: npm install && npm install -g @lhci/cli@0.13.x

          - name: Run Lighthouse
            run: lhci autorun

